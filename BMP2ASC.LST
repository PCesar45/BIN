Turbo Assembler	 Version 4.1	    11/11/20 19:34:45	    Page 1
bmp2asc.ASM



      1				     ;Examen1 de arquitectura de computadores
      2				     extrn PonerModoVideo    :far
      3
      4	0000			     Datos Segment para	public 'Datos'
      5					     extrn TipoVideo :byte
      6	0000  FF*(??)			     filename db    0FFh Dup (?)
      7	00FF  45 72 72 6F 72 20	61+	     ErrorMsg db    'Error al abrir archivo', 13, 10,'$'
      8	      6C 20 61 62 72 69	72+
      9	      20 61 72 63 68 69	76+
     10	      6F 0D 0A 24
     11	0118  ????			     filehandle	dw ?
     12	011A			     Datos EndS
     13				      ListPush	Macro lista
     14						     IRP i,<lista>
     15							     Push i
     16						     EndM
     17					     EndM
     18
     19					     ListPop  Macro lista
     20						     IRP i,<lista>
     21							     Pop i
     22						     EndM
     23					     EndM
     24
     25				     ;----------------------------
     26	0000			     Codigo Segment
     27				     Assume cs:Codigo ,	ds:Datos
     28
     29	0000			     GetCommanderLine Proc Near
     30	      =0080				     LongLC    EQU   80h
     31						     ListPush  <Es, Di,	Si, Cx,	Bp>
2    32	0000  06					     Push Es
2    33	0001  57					     Push Di
2    34	0002  56					     Push Si
2    35	0003  51					     Push Cx
2    36	0004  55					     Push Bp
     37	0005  8B EC				     Mov   Bp,Sp
     38	0007  8C C0				     Mov   Ax,Es
     39	0009  8E D8				     Mov   Ds,Ax
     40	000B  8B 7E 0C				     Mov   Di,12[Bp]
     41	000E  8B 46 0E				     Mov   Ax,14[Bp]
     42	0011  8E C0				     Mov   Es,Ax
     43	0013  33 C9				     Xor   Cx,Cx
     44	0015  8A 0E 0080			     Mov   Cl,Byte Ptr Ds:[LongLC]
     45	0019  FE C9				     dec   cl
     46	001B  BE 0082				     Mov   Si,2[LongLC]			       ;dos = uno por la posici�n 81h	y   +
     47				     uno m�s por el espacio en blanco.
     48	001E  F3> A4				     Rep   Movsb
     49						     ListPop <Bp, Bx, Si, Di, Es>
2    50	0020  5D					     Pop Bp
2    51	0021  5B					     Pop Bx
2    52	0022  5E					     Pop Si
2    53	0023  5F					     Pop Di
2    54	0024  07					     Pop Es
     55	0025  C2 0004				     Ret   4
     56	0028			     GetCommanderLine EndP
     57	0028			     OpenFile proc far ;Sirve
Turbo Assembler	 Version 4.1	    11/11/20 19:34:45	    Page 2
bmp2asc.ASM



     58
     59					 ; Open	file
     60
     61	0028  B4 3D			 mov ah, 3Dh
     62	002A  32 C0			 xor al, al
     63	002C  BA 0000r			 mov dx, offset	filename
     64	002F  CD 21			 int 21h
     65
     66	0031  72 04			 jc openerror
     67	0033  A3 0118r			 mov [filehandle], ax
     68	0036  CB			 ret
     69
     70	0037				 openerror:
     71	0037  BA 00FFr			 mov dx, offset	ErrorMsg
     72	003A  B4 09			 mov ah, 9h
     73	003C  CD 21			 int 21h
     74	003E  CB			 ret
     75	003F			     OpenFile endp
     76	003F			     Inicio:
     77
     78
     79	003F  B8 0000s			     mov ax,Datos
     80	0042  8E D8			     mov ds,ax
     81
     82					     ;Leer el comando ,	nombre del archivo
     83	0044  1E			     push Ds
     84	0045  B8 0000s			     mov ax,seg	filename
     85	0048  50			     push ax
     86	0049  B8 0000r			     lea ax,filename
     87	004C  50			     push ax
     88	004D  E8 FFB0			     call GetCommanderLine
     89	0050  1F			     pop Ds
     90
     91	0051  0E E8 FFD3		     call OpenFile
     92
     93					     ;lea dx,filename ;lea=carga la direccion al registro (lea registro16,direccion)
     94					     ;mov ah,09h ;le mueve al registro ah un 09	en hexadecimal por eso la h
     95					     ;int 21h  ;int = interrupcion /interrupcion 21,9(ah =09): imprime hasta toparse
     96						     ; con el simbolo "$",		por eso	en la linea anterior le	movi un	09  +
     97				     al	ah
     98					     ;Espera que le de enter  para salirse
     99					     ;mov ah,01h
    100					     ;int 21h
    101					     ;xor ah,ah
    102
    103	0055  C6 06 0000e 12		     mov TipoVideo,18
    104	005A  9A 00000000se		     call PonerModoVideo
    105
    106					     ;Espera que le de enter  para salirse
    107	005F  B4 01			     mov ah,01h
    108	0061  CD 21			     int 21h
    109	0063  32 E4			     xor ah,ah
    110
    111	0065  C6 06 0000e 03		     mov TipoVideo,3
    112	006A  9A 00000000se		     call PonerModoVideo
    113
    114
Turbo Assembler	 Version 4.1	    11/11/20 19:34:45	    Page 3
bmp2asc.ASM



    115	006F  B8 4C00			 mov ax,4c00h
    116	0072  CD 21			     int 21h
    117
    118	0074			      Codigo EndS
    119					     End Inicio
Turbo Assembler	 Version 4.1	    11/11/20 19:34:45	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "11/11/20"
??FILENAME			  Text	 "bmp2asc "
??TIME				  Text	 "19:34:45"
??VERSION			  Number 040A
@CPU				  Text	 0101H
@CURSEG				  Text	 CODIGO
@FILENAME			  Text	 BMP2ASC
@WORDSIZE			  Text	 2
ERRORMSG			  Byte	 DATOS:00FF
FILEHANDLE			  Word	 DATOS:0118
FILENAME			  Byte	 DATOS:0000
GETCOMMANDERLINE		  Near	 CODIGO:0000
INICIO				  Near	 CODIGO:003F
LONGLC				  Number 0080
OPENERROR			  Near	 CODIGO:0037
OPENFILE			  Far	 CODIGO:0028
PONERMODOVIDEO			  Far	 ----:---- Extern
TIPOVIDEO			  Byte	 DATOS:---- Extern

Macro Name

LISTPOP
LISTPUSH

Groups & Segments		  Bit Size Align  Combine Class

CODIGO				  16  0074 Para	  none
DATOS				  16  011A Para	  Public  DATOS
